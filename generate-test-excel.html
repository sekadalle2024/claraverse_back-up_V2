<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de fichier Excel de test - Format Flowise</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            margin: 10px;
            display: block;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .preview {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #FFD700;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä G√©n√©rateur Excel - Format Flowise</h1>
        
        <div class="instructions">
            <h3>üìã Instructions</h3>
            <p>Ce g√©n√©rateur cr√©e un fichier Excel de test avec la structure exacte pour tester l'extraction et le formatage Flowise dans ClaraVerse.</p>
            <p><strong>Utilisation :</strong></p>
            <ol>
                <li>Cliquez sur "G√©n√©rer fichier Excel de test"</li>
                <li>Le fichier sera t√©l√©charg√© automatiquement</li>
                <li>Uploadez ce fichier dans ClaraVerse</li>
                <li>V√©rifiez que l'alerte affiche le format JSON Flowise correct</li>
            </ol>
        </div>

        <button onclick="generateTestExcel()">üìä G√©n√©rer fichier Excel de test</button>
        
        <div class="preview" id="preview">
            <strong>Aper√ßu des donn√©es qui seront g√©n√©r√©es :</strong>
            
            Feuille 1: "Metadata"
            - Etape: "Programme"
            - reference: "Programme-001"
            
            Feuille 2: "Tasks"
            - Colonnes: t√¢ches cl√©s, Point de controle, Risque, contr√¥le audit, Document
            - 8 lignes de donn√©es de t√¢ches de caisse
            
            Feuille 3: "Links"
            - T√©l√©charger: "https://www.notion.so/Projet-arc-narratif-templates-1f1913f0159380968c0bf66dec42d350?pvs=21"
            
            <strong>Format JSON Flowise attendu :</strong>
            {
              "Etape mission - Programme": [
                {
                  "table 1": {
                    "Etape": "Programme",
                    "reference": "Programme-001"
                  }
                },
                {
                  "table 2": [
                    {
                      "t√¢ches cl√©s": "Effectuer l'arr√™t√© de caisse quotidien",
                      "Point de controle": "Conformit√© du solde physique...",
                      ...
                    }
                  ]
                },
                {
                  "table 3": {
                    "T√©l√©charger": "https://www.notion.so/..."
                  }
                }
              ]
            }
        </div>
    </div>

    <script>
        function generateTestExcel() {
            // Cr√©er un nouveau classeur
            const wb = XLSX.utils.book_new();
            
            // Feuille 1: Metadata (table 1)
            const metadataData = [
                ['Etape', 'reference'],
                ['Programme', 'Programme-001']
            ];
            const ws1 = XLSX.utils.aoa_to_sheet(metadataData);
            XLSX.utils.book_append_sheet(wb, ws1, 'Metadata');
            
            // Feuille 2: Tasks (table 2)
            const tasksData = [
                ['t√¢ches cl√©s', 'Point de controle', 'Risque', 'contr√¥le audit', 'Document'],
                [
                    'Effectuer l\'arr√™t√© de caisse quotidien',
                    'Conformit√© du solde physique avec le solde th√©orique du brouillard de caisse. Existence d\'un comptage contradictoire.',
                    'D√©tournement d\'esp√®ces, erreur de comptage non d√©tect√©e, dissimulation d\'√©carts.',
                    '1. S√©lectionner un √©chantillon d\'arr√™t√©s de caisse sur la p√©riode. 2. V√©rifier la pr√©sence d\'une double signature (caissier et superviseur). 3. Recalculer l\'arr√™t√© et le rapprocher du brouillard de caisse et des pi√®ces justificatives.',
                    'Proc√®s-verbal d\'arr√™t√© de caisse, Brouillard de caisse.'
                ],
                [
                    'Surveiller le niveau de l\'encaisse',
                    'Respect du plafond d\'encaisse autoris√© en fin de journ√©e.',
                    'Vol ou perte aggrav√©e en cas de sinistre. Co√ªt d\'opportunit√© (fonds oisifs).',
                    '1. Obtenir la proc√©dure de tr√©sorerie fixant le plafond. 2. Analyser les soldes de caisse de fin de journ√©e sur un mois. 3. Identifier les d√©passements et v√©rifier s\'ils ont √©t√© justifi√©s et suivis d\'une remise en banque rapide.',
                    'Proc√©dure de tr√©sorerie, Journal de caisse.'
                ],
                [
                    'Effectuer les remises en banque',
                    'Respect du d√©lai de remise en banque des esp√®ces et ch√®ques (ex: J+1). Conformit√© des bordereaux.',
                    'Perte ou vol des moyens de paiement, retard dans la disponibilit√© des fonds, risque d\'impay√© accru sur les ch√®ques.',
                    '1. Suivre un √©chantillon de recettes (ch√®ques, esp√®ces) de leur r√©ception √† leur remise en banque. 2. Calculer le d√©lai de remise. 3. Rapprocher les bordereaux de remise avec les souches et les relev√©s bancaires.',
                    'Bordereaux de remise en banque, Relev√©s bancaires.'
                ],
                [
                    'Justifier les d√©penses de caisse',
                    'Existence d\'une pi√®ce justificative originale, conforme et approuv√©e pour chaque sortie de caisse.',
                    'D√©penses non autoris√©es, non professionnelles ou fictives. Risque fiscal (rejet de charges).',
                    '1. S√©lectionner un √©chantillon de d√©penses de caisse. 2. Pour chaque d√©pense, v√©rifier la pr√©sence d\'une pi√®ce justificative valide. 3. S\'assurer que la pi√®ce a √©t√© approuv√©e par un responsable autoris√© avant le paiement.',
                    'Pi√®ces justificatives (factures, re√ßus), Brouillard de caisse.'
                ],
                [
                    'Assurer la s√©curit√© physique des fonds',
                    'Fonds conserv√©s dans un coffre-fort ferm√©. Acc√®s restreint aux seules personnes habilit√©es.',
                    'Vol interne ou externe tr√®s √©lev√©.',
                    '1. Inspection physique des installations (coffre-fort, serrures). 2. Entretien sur les pratiques de gestion de la cl√©/code. 3. V√©rifier la liste des personnes habilit√©es et sa mise √† jour.',
                    'Proc√©dure de gestion de caisse, Liste des personnes habilit√©es.'
                ],
                [
                    'G√©rer les acc√®s et la s√©paration des t√¢ches',
                    'La personne qui g√®re la caisse est diff√©rente de celle qui enregistre les op√©rations en comptabilit√©.',
                    'Manipulation des enregistrements comptables pour masquer un d√©tournement.',
                    '1. Analyser la matrice des habilitations du syst√®me comptable. 2. V√©rifier que le caissier n\'a pas les droits pour comptabiliser les op√©rations de caisse. 3. Confirmer que la comptabilisation est faite par un tiers sur la base de documents valid√©s.',
                    'Matrice des habilitations, Description de fonction.'
                ],
                [
                    'R√©aliser des contr√¥les inopin√©s',
                    'Existence de proc√®s-verbaux de contr√¥les de caisse inopin√©s r√©alis√©s par un tiers ind√©pendant (N+1, contr√¥le interne).',
                    'Dissimulation de fraudes ou d\'erreurs sur une longue p√©riode. Manque de dissuasion.',
                    '1. Demander les PV des contr√¥les inopin√©s sur les 12 derniers mois. 2. V√©rifier leur fr√©quence (ex: trimestrielle). 3. Analyser le contenu des PV (travaux men√©s, √©carts constat√©s, signature).',
                    'Proc√®s-verbaux de contr√¥le de caisse inopin√©.'
                ],
                [
                    'G√©rer l\'alimentation de la caisse',
                    'L\'alimentation de la caisse se fait par un moyen trac√© (ch√®que, virement) et non par pr√©l√®vement sur les recettes.',
                    'Rupture de l\'exhaustivit√© des recettes, perte de la piste d\'audit.',
                    '1. Analyser les mouvements d\'alimentation de la caisse sur une p√©riode. 2. S\'assurer que chaque alimentation provient d\'un ch√®que ou virement bancaire. 3. V√©rifier qu\'il n\'y a pas de pr√©l√®vement sur les recettes en esp√®ces.',
                    'Demandes d\'alimentation de caisse, Journal de caisse, Relev√©s bancaires.'
                ]
            ];
            const ws2 = XLSX.utils.aoa_to_sheet(tasksData);
            XLSX.utils.book_append_sheet(wb, ws2, 'Tasks');
            
            // Feuille 3: Links (table 3)
            const linksData = [
                ['T√©l√©charger'],
                ['https://www.notion.so/Projet-arc-narratif-templates-1f1913f0159380968c0bf66dec42d350?pvs=21']
            ];
            const ws3 = XLSX.utils.aoa_to_sheet(linksData);
            XLSX.utils.book_append_sheet(wb, ws3, 'Links');
            
            // G√©n√©rer et t√©l√©charger le fichier
            const fileName = 'Etape mission - Programme.xlsx';
            XLSX.writeFile(wb, fileName);
            
            alert(`‚úÖ Fichier Excel g√©n√©r√© et t√©l√©charg√© : ${fileName}\n\nVous pouvez maintenant l'uploader dans ClaraVerse pour tester l'extraction !`);
        }
    </script>
</body>
</html>
